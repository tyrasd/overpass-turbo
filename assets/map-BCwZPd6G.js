import{a as e,c as t,d as n,i as r,l as i,n as a,r as o}from"./ide-UpNBtMlm.js";t();var s=n(i());(0,s.default)(document).ready(()=>{let t={};window.addEventListener(`message`,async e=>{let a=typeof e.data==`string`?JSON.parse(e.data):{};if(a.cmd===`update_map`)n.code.overpass=a.value[0],i.update_map();else if(a.cmd===`cache`){n.code.overpass=a.value[0];let e=await i.getQuery(),o=i.getQueryLang();r.run_query(e,o,t,!0,void 0,void 0,i.mapcss)}},!1),s.default.fn.dialog=function(){alert(`error :( ${(0,s.default)(this).html()}`)},e.appname=`overpass-ide-map`;let n={code:{},server:e.defaultServer,tileServer:e.defaultTiles,silent:!1,force_simple_cors_request:!0,disable_poiomatic:!1},i={map:void 0,mapcss:``,async getQuery(){let e=n.code.overpass,t=new o;e=await t.parse(e,{});let r=``;t.hasStatement(`style`)&&(r=t.getStatement(`style`)),i.mapcss=r;let a=null;if(t.hasStatement(`data`)){a=t.getStatement(`data`),a=a.split(`,`);let e=a[0].toLowerCase();a=a.slice(1);let n={};for(let e of a){let t=e.split(`=`);n[t[0]]=t[1]}a={mode:e,options:n}}return i.data_source=a,e=e.trim(),e},getQueryLang(){return s.default.trim(n.code.overpass).match(/^</)?`xml`:`OverpassQL`},async update_map(){(0,s.default)(`#data_stats`).remove(),r.osmLayer!==void 0&&i.map.removeLayer(r.osmLayer);let e=await i.getQuery(),n=i.getQueryLang();r.run_query(e,n,t,!1,void 0,void 0,i.mapcss),(0,s.default)(`#map_blank`).remove()}};r.init(),s.default.support.cors!=1&&(0,s.default)(`<div title="Your browser is not supported :("><p>The browser you are currently using, is not capable of running this Application. <small>It has to support <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">cross origin resource sharing (CORS)</a>.</small></p><p>Please update to a more up-to-date version of your browser or switch to a more capable browser! Recent versions of <a href="http://www.opera.com">Opera</a>, <a href="http://www.google.com/intl/de/chrome/browser/">Chrome</a> and <a href="http://www.mozilla.org/de/firefox/">Firefox</a> have been tested to work.</p></div>`).dialog({modal:!0});let c=a();n.code.overpass=c.get(`Q`),n.silent=c.has(`silent`),i.map=new L.Map(`map`);let l=n.tileServer,u=e.tileServerAttribution,d=new L.TileLayer(l,{attribution:u});i.map.setView([0,0],1).addLayer(d),new L.Control.Scale({metric:!0,imperial:!1}).addTo(i.map),(0,s.default)(document).on({ajaxStart(){(0,s.default)(`#loading-dialog`).addClass(`is-active`)},ajaxStop(){(0,s.default)(`#loading-dialog`).removeClass(`is-active`)}}),i.map.on(`layeradd`,e=>{if(e.layer instanceof L.GeoJSON){i.map.setView([0,0],18,!0);try{i.map.fitBounds(e.layer.getBounds())}catch{}}}),r.handlers.onEmptyMap=e=>{(0,s.default)(`<div id="map_blank" style="z-index:700; display:block; position:absolute; top:50px; width:100%; text-align:center; background-color:#eee; opacity: 0.8;">This map intentionally left blank. <small>(${e})</small></div>`).appendTo(`#map`)},n.silent?(r.handlers.onAjaxError=e=>{parent.postMessage(JSON.stringify({handler:`onAjaxError`,msg:e}),`*`)},r.handlers.onQueryError=e=>{parent.postMessage(JSON.stringify({handler:`onQueryError`,msg:e}),`*`)}):(r.handlers.onAjaxError=e=>{alert(`An error occured during the execution of the overpass query!\n${e}`)},r.handlers.onQueryError=e=>{alert(`An error occured during the execution of the overpass query!\nThis is what overpass API returned:\n${e}`)}),r.handlers.onGeoJsonReady=()=>{i.map.addLayer(r.osmLayer)},r.handlers.onPopupReady=e=>{e.openOn(i.map)},r.handlers.onDataReceived=(e,t,n,r,i)=>{i()},r.handlers.onRawDataPresent=()=>{parent.postMessage(JSON.stringify({query:n.code.overpass,resultType:r.resultType,resultText:r.resultText}),`*`)},i.update_map()});
//# sourceMappingURL=map-BCwZPd6G.js.map